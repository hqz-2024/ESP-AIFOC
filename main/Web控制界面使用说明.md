# Web控制界面使用说明

## 🌐 访问方式

1. **上传程序到ESP32**
2. **打开串口监视器**，查看ESP32的IP地址，例如：
   ```
   WiFi connected!
   IP address: 192.168.1.100
   ```
3. **浏览器访问** `http://192.168.1.100`

---

## 🎛️ 界面功能

### 1. 实时状态显示

界面顶部显示电机的实时状态：

- **📊 当前速度** - 电机实际转速 (rad/s)
- **📐 当前角度** - 电机当前角度 (rad 和 度)
- **⚡ 电流信息** - Q轴电流（如果有电流传感器）
- **🎯 目标值** - 根据当前模式显示对应的目标值

### 2. 控制模式选择

通过下拉菜单选择控制模式：

| 模式 | 说明 | 应用场景 |
|------|------|----------|
| **速度控制** | 控制电机转速 | 风扇、泵、恒速应用 |
| **位置控制** | 控制电机角度 | 云台、机械臂、精确定位 |
| **扭矩控制** | 控制电机扭矩 | 力控、恒力输出 |

**操作方法：**
- 点击"控制模式"下拉菜单
- 选择需要的模式
- 输入框会自动切换到对应的参数输入

### 3. 参数设置

根据选择的控制模式，输入对应的目标值：

#### 速度控制模式
- **输入：** 目标转速 (rad/s)
- **范围：** -50 ~ 50 rad/s（根据配置）
- **示例：** 输入 `10` 表示 10 rad/s

#### 位置控制模式
- **输入：** 目标角度 (rad)
- **提示：** 1 rad ≈ 57.3°, 6.28 rad = 360°
- **示例：** 输入 `3.14` 表示 180°

#### 扭矩控制模式
- **有电流传感器：** 输入电流值 (A)
  - 范围：-5 ~ 5 A（根据配置）
  - 示例：输入 `2.0` 表示 2A 电流
  
- **无电流传感器：** 输入电压值 (V)
  - 范围：-12 ~ 12 V（根据配置）
  - 示例：输入 `3.0` 表示 3V 电压

### 4. 应用设置

- 选择好模式和参数后，点击 **"✓ 应用设置"** 按钮
- 系统会同时切换模式并设置目标值
- 显示成功页面后自动返回主页
- 页面每2秒自动刷新显示最新状态

---

## 💡 使用示例

### 示例1：速度控制

1. 访问 `http://192.168.1.100`
2. 控制模式选择：**速度控制**
3. 输入目标转速：`10`
4. 点击"应用设置"
5. 电机开始以10 rad/s转速运行

### 示例2：位置控制

1. 控制模式选择：**位置控制**
2. 输入目标角度：`6.28`（360度）
3. 点击"应用设置"
4. 电机转动到360度位置并保持

### 示例3：扭矩控制（有电流传感器）

1. 控制模式选择：**扭矩控制**
2. 输入目标扭矩：`2.0` A
3. 点击"应用设置"
4. 电机输出恒定2A电流（恒扭矩）

### 示例4：快速切换模式

1. 当前是速度控制模式，电机在转动
2. 切换到位置控制模式
3. 输入目标角度：`0`
4. 点击"应用设置"
5. 电机立即切换到位置控制，回到0度位置

---

## 🔧 高级功能

### 1. 动态模式切换

- **无需重启**：可以在运行时随时切换控制模式
- **即时生效**：切换后立即按新模式运行
- **保留参数**：切换模式时，之前设置的参数会保留

### 2. 自动刷新

- 页面每2秒自动刷新
- 实时显示电机状态
- 无需手动刷新浏览器

### 3. 响应式设计

- 支持手机、平板、电脑访问
- 界面自动适配屏幕大小
- 触摸友好的按钮设计

---

## 📊 状态指示

### 模式徽章

页面顶部显示当前控制模式的徽章：
- 🔵 **速度控制** - 蓝色徽章
- 🔵 **位置控制** - 蓝色徽章
- 🔵 **扭矩控制** - 蓝色徽章

### 电流显示（如果有电流传感器）

- **电流 Q** - 产生扭矩的电流分量
- 实时更新，每2秒刷新

---

## ⚠️ 注意事项

### 1. 安全限制

- 速度限制：±50 rad/s（可在 `user_config.h` 修改）
- 电流限制：±5 A（可在 `user_config.h` 修改）
- 电压限制：±12 V（可在 `user_config.h` 修改）

### 2. 模式切换

- 切换模式时电机会短暂调整
- 建议在电机低速或静止时切换
- 切换后检查目标值是否合理

### 3. 网络延迟

- 设置生效有1-2秒延迟（自动刷新）
- 如需立即查看，可手动刷新浏览器
- 串口监视器可实时查看状态

### 4. 参数范围

- 输入超出范围的值会被自动限制
- 建议从小值开始测试
- 逐步增加到目标值

---

## 🛠️ 故障排查

### 问题1：无法访问Web界面

**解决方法：**
1. 检查ESP32是否连接WiFi（串口显示IP地址）
2. 确认电脑/手机与ESP32在同一WiFi网络
3. 尝试ping ESP32的IP地址
4. 检查防火墙设置

### 问题2：设置后电机无反应

**解决方法：**
1. 检查串口输出，确认设置已接收
2. 检查电机是否正确初始化
3. 检查电源是否充足
4. 检查传感器连接

### 问题3：页面不刷新

**解决方法：**
1. 手动刷新浏览器（F5）
2. 清除浏览器缓存
3. 检查JavaScript是否被禁用

---

## 📖 相关配置

### 修改刷新间隔

编辑 `user_config.h`：
```cpp
#define WEB_REFRESH_INTERVAL    2000    // 页面刷新间隔 (ms)
```

### 修改限制参数

编辑 `user_config.h`：
```cpp
#define MOTOR_VOLTAGE_LIMIT     12.0f   // 电压限制 (V)
#define MOTOR_VELOCITY_LIMIT    50.0f   // 速度限制 (rad/s)
#define MOTOR_CURRENT_LIMIT     5.0f    // 电流限制 (A)
```

### 修改WiFi设置

编辑 `user_config.h`：
```cpp
#define WIFI_SSID       "你的WiFi名称"
#define WIFI_PASSWORD   "你的WiFi密码"
```

---

## 🎯 总结

### ✅ 主要特点

- ✨ **简洁直观** - 一个页面完成所有操作
- 🔄 **动态切换** - 运行时随时切换控制模式
- 📱 **响应式** - 支持各种设备访问
- ⚡ **实时更新** - 自动刷新显示最新状态
- 🎛️ **统一接口** - 一个表单同时设置模式和参数

### 🚀 使用流程

1. 浏览器访问ESP32 IP地址
2. 选择控制模式（速度/位置/扭矩）
3. 输入目标值
4. 点击"应用设置"
5. 查看实时状态

**现在可以通过Web界面轻松控制电机了！** 🎉

